<!DOCTYPE html>
<html>
  <head>
    <style>
      .blocklyPath {
        stroke-width: 1px;
        box-sizing: border-box;
      }

      body {
        background-color: #202020;
        color: white;
      }

      svg {
        border: 3px solid white;
      }

      .blocklyText {
        font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
        fill: white;
      }

      .blocklyEditableText {
        fill: black;
      }

      .blah {
        stroke: #389438;
        fill: #59c059;
      }

      .one {
        --test: #ffffff;
      }

      .two {
        background-color: var(--test);
      }

      .three {
        --test: black;
      }

      .four {
        color: var(--test);
      }
    </style>
  </head>

  <body>
    <!-- <p class="one two three four">Hello! </p> -->
    <script>
      const SVG_NS = "http://www.w3.org/2000/svg";

      var svg = document.createElementNS(SVG_NS, "svg");
      document.getElementsByTagName("body")[0].appendChild(svg);
      svg.setAttribute("width", 500);
      svg.setAttribute("height", 500);
      var container = document.createElementNS(SVG_NS, "g");
      svg.appendChild(container);

      const CATEGORY_VARIABLE = {
        stroke: "#DB6E00",
        fill: "#FF8C1A",
      };

      const CATEGORY_OPERATORS = {
        stroke: "#389438",
        fill: "#59C059",
      };

      const CATEGORY_INPUT = {
        stroke: "#000",
        fill: "#FFF",
      };

      const CATEGORY_LOOKS = {
        stroke: "#774DCB",
        fill: "#9966FF",
      };

      const SHAPE_ROUND_BLOCK = {
        padding: 12,
        minWidth: 20,
        background: function (width) {
          return `m -12 -20 m 20 0 h ${width - 16} a 20 20 0 0 1 0 40 H 8 a 20 20 0 0 1 0 -40 z`;
        },
      };

      const SHAPE_BOOLEAN_BLOCK = {
        padding: 20,
        minWidth: 20,
        background: function (width) {
          return `m -20 -20 m 20 0 h ${width} l 20 20 l -20 20 H 0 l -20 -20 l 20 -20 z`;
        },
      };

      const SHAPE_STACK_BLOCK = {
        padding: 8,
        minWidth: 60,
        background: function (width) {
          return `m -8 -20 A 4 4 0 0 1 -4 -24 H 4 c 2 0 3 1 4 2 l 4 4 c 1 1 2 2 4 2 h 12 c 2 0 3 -1 4 -2 l 4 -4 C 37 -23 38 -24 40 -24 H ${width} a 4 4 0 0 1 4 4 v 40 a 4 4 0 0 1 -4 4 H 40 c -2 0 -3 1 -4 2 l -4 4 c -1 1 -2 2 -4 2 h -12 c -2 0 -3 -1 -4 -2 l -4 -4 c -1 -1 -2 -2 -4 -2 H -4 a 4 4 0 0 1 -4 -4 z`;
        },
      };

      const SHAPE_HAT_BLOCK = {
        padding: 8,
        minWidth: 60,
        background: function (width) {
          return `m -8 -20 A 4 4 0 0 1 -4 -24 H ${width} a 4 4 0 0 1 4 4 v 40 a 4 4 0 0 1 -4 4 H 40 c -2 0 -3 1 -4 2 l -4 4 c -1 1 -2 2 -4 2 h -12 c -2 0 -3 -1 -4 -2 l -4 -4 c -1 -1 -2 -2 -4 -2 H -4 a 4 4 0 0 1 -4 -4 z`;
        },
      };

      const SHAPE_TERMINATOR_BLOCK = {
        padding: 8,
        minWidth: 60,
        background: function (width) {
          return `m -8 -20 A 4 4 0 0 1 -4 -24 H 4 c 2 0 3 1 4 2 l 4 4 c 1 1 2 2 4 2 h 12 c 2 0 3 -1 4 -2 l 4 -4 C 37 -23 38 -24 40 -24 H ${width} a 4 4 0 0 1 4 4 v 40 a 4 4 0 0 1 -4 4 H -4 a 4 4 0 0 1 -4 -4 z`;
        },
      };

      let shape = SHAPE_STACK_BLOCK;
      let category = CATEGORY_LOOKS;

      class BlockElement {
        constructor(element, padding, width) {
          this.dom = element;
          this.padding = padding;
          this._width = width;
        }

        get width() {
          if (this._width) return this._width;
          this._width = this.dom.getBoundingClientRect().width;
          if (this._width === 0) throw new Error("Failed to calculate width of element.");
          this._width += this.padding * 2;
          return this._width;
        }

        setTranslation(x, y) {
          this.dom.setAttribute("transform", `translate(${x + this.padding}, ${y})`);
        }
      }

      function createTextBlockElement(text) {
        let textElement = document.createElementNS(SVG_NS, "text");
        textElement.setAttribute("class", "blocklyText");
        textElement.setAttribute("dominant-baseline", "middle");
        textElement.appendChild(document.createTextNode(text));
        return new BlockElement(textElement, 0);
      }

      function createBackgroundDOMElement() {
        let cont = document.createElementNS(SVG_NS, "g");
        let dom = document.createElementNS(SVG_NS, "path");
        dom.setAttribute("class", "blocklyPath");
        cont.appendChild(dom);
        return cont;
      }

      function createBackgroundBlockElement(cont, stroke, fill, shape, width) {
        const dom = cont.children[0];
        dom.setAttribute("class", "one");
        dom.setAttribute("stroke", stroke);
        dom.setAttribute("fill", fill);
        if (width < shape.minWidth) width = shape.minWidth;
        dom.setAttribute("d", shape.background(width));
        return new BlockElement(cont, shape.padding, width + shape.padding * 2);
      }

      var backgroundDom = container.appendChild(createBackgroundDOMElement());

      let offset = 0;

      var textElement = createTextBlockElement("show");
      container.appendChild(textElement.dom);
      offset += textElement.width;
      offset += 8;

      // var variableContainer = document.createElementNS(SVG_NS, "g");

      var variableBgDom = container.appendChild(createBackgroundDOMElement());
      var variableTxtEle = createTextBlockElement("Hello, World!");
      variableBgDom.appendChild(variableTxtEle.dom);
      var variableEle = createBackgroundBlockElement(
        variableBgDom,
        category.stroke,
        CATEGORY_VARIABLE.fill,
        SHAPE_BOOLEAN_BLOCK,
        variableTxtEle.width
      );

      variableEle.setTranslation(offset, 0);
      offset += variableEle.width;

      var blackgroundElement = createBackgroundBlockElement(
        backgroundDom,
        category.stroke,
        category.fill,
        shape,
        offset
      );
      container.setAttribute("transform", `translate(${blackgroundElement.padding}, 100)`);
    </script>
  </body>
</html>
